import{d as y}from"./chunk-E3BUGX3N.js";import{a as P}from"./chunk-EJSEB2A5.js";import{a as D}from"./chunk-WQJ3ILH5.js";import{k as h,l as C,n as _}from"./chunk-GDGZUMXV.js";import{Aa as g,Na as m,Oa as w,Pa as l,Qa as E,Sa as n,Ta as t,Ua as f,Xa as k,Ya as x,Za as p,_ as u,cb as i,db as c,eb as v,gb as b,ha as M,ia as S,za as a}from"./chunk-6VMPXGO3.js";function N(r,d){r&1&&(n(0,"div",6)(1,"p"),i(2,"\u{1F4CA} No hay datos todav\xEDa"),t(),n(3,"p",7),i(4,"Los clics en productos aparecer\xE1n aqu\xED"),t()())}function A(r,d){if(r&1&&(n(0,"div",10)(1,"div",11)(2,"span",12),i(3),t(),n(4,"span",13),i(5),t()(),n(6,"div",14)(7,"div",15)(8,"span",16),i(9),t()()()()),r&2){let e=d.$implicit;a(3),c(e.productName),a(2),v("",e.clicks," clics"),a(2),E("width",e.percentage,"%"),w("data-clicks",e.clicks),a(2),c(e.clicks)}}function $(r,d){if(r&1&&(n(0,"div",8),m(1,A,10,6,"div",9),t()),r&2){let e=p();a(),l("ngForOf",e.chartData)}}var F=(()=>{class r{constructor(e){this.productsService=e,this.chartData=[],this.maxClicks=0}ngOnInit(){this.updateChart(),this.clicksSubscription=this.productsService.clicks$.subscribe(()=>{this.updateChart()})}ngOnDestroy(){this.clicksSubscription?.unsubscribe()}updateChart(){let e=this.productsService.getClicksByProduct();this.maxClicks=Math.max(...e.map(o=>o.clicks),1),this.chartData=e.map(o=>({productName:o.productName,clicks:o.clicks,percentage:o.clicks/this.maxClicks*100}))}clearStats(){confirm("\xBFEst\xE1s seguro de que quieres limpiar todas las estad\xEDsticas?")&&(this.productsService.clearStats(),this.updateChart())}static{this.\u0275fac=function(o){return new(o||r)(g(P))}}static{this.\u0275cmp=u({type:r,selectors:[["app-product-chart"]],standalone:!0,features:[b],decls:9,vars:2,consts:[[1,"chart-container"],[1,"chart-header"],[1,"clear-btn",3,"click"],[1,"chart-content"],["class","no-data",4,"ngIf"],["class","bars-container",4,"ngIf"],[1,"no-data"],[1,"hint"],[1,"bars-container"],["class","bar-row",4,"ngFor","ngForOf"],[1,"bar-row"],[1,"bar-label"],[1,"product-name"],[1,"click-count"],[1,"bar-wrapper"],[1,"bar"],[1,"bar-value"]],template:function(o,s){o&1&&(n(0,"div",0)(1,"div",1)(2,"h3"),i(3,"Estad\xEDsticas de Clics por Producto"),t(),n(4,"button",2),x("click",function(){return s.clearStats()}),i(5,"Limpiar estad\xEDsticas"),t()(),n(6,"div",3),m(7,N,5,0,"div",4)(8,$,2,1,"div",5),t()()),o&2&&(a(7),l("ngIf",s.chartData.length===0||s.maxClicks===0),a(),l("ngIf",s.chartData.length>0&&s.maxClicks>0))},dependencies:[_,h,C],styles:[".chart-container[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid rgba(255,255,255,.15);border-radius:12px;padding:1.5rem;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}.chart-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid rgba(255,255,255,.1)}.chart-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600}.clear-btn[_ngcontent-%COMP%]{background:#ff6b6b33;color:#ff6b6b;border:1px solid #ff6b6b;padding:.5rem 1rem;border-radius:6px;cursor:pointer;font-size:.85rem;font-weight:600;transition:all .3s ease}.clear-btn[_ngcontent-%COMP%]:hover{background:#ff6b6b;color:#fff}.chart-content[_ngcontent-%COMP%]{min-height:300px}.no-data[_ngcontent-%COMP%]{text-align:center;padding:3rem 1rem;color:#fff9}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-child{font-size:2rem;margin:0 0 .5rem}.no-data[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:.9rem;margin:0}.bars-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.bar-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.bar-label[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:.9rem}.product-name[_ngcontent-%COMP%]{font-weight:600;color:#000000e6}.click-count[_ngcontent-%COMP%]{font-size:.85rem;color:#fff9}.bar-wrapper[_ngcontent-%COMP%]{background:#ffffff1a;border-radius:8px;height:40px;overflow:hidden;position:relative}.bar[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,red,#ff6b6b);border-radius:8px;display:flex;align-items:center;justify-content:flex-end;padding-right:1rem;transition:width .6s ease;position:relative;min-width:40px;box-shadow:0 2px 8px #ff00004d}.bar-value[_ngcontent-%COMP%]{color:#fff;font-weight:700;font-size:.9rem;text-shadow:0 1px 2px rgba(0,0,0,.3)}@keyframes _ngcontent-%COMP%_barGrow{0%{width:0}}.bar[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_barGrow .8s ease-out}@media (max-width: 768px){.chart-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:flex-start}.clear-btn[_ngcontent-%COMP%]{width:100%}.bar-label[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.25rem}}"]})}}return r})();function j(r,d){if(r&1&&(n(0,"div",17)(1,"span",12),i(2),t(),n(3,"span",13),i(4),t(),n(5,"span",14),i(6),t()()),r&2){let e=d.$implicit;a(2),c(e.email),a(2),c(e.clicks),a(2),v("$",e.spent.toFixed(2),"")}}function R(r,d){if(r&1&&(n(0,"div",10)(1,"h4"),i(2,"Compras por Usuario"),t(),n(3,"div",11)(4,"span",12),i(5,"Usuario"),t(),n(6,"span",13),i(7,"Compras"),t(),n(8,"span",14),i(9,"Gastado"),t()(),n(10,"div",15),m(11,j,7,3,"div",16),t()()),r&2){let e=p();a(11),l("ngForOf",e.userStats)}}function V(r,d){r&1&&(n(0,"div",18)(1,"p"),i(2,"\u{1F4CA} No hay compras registradas todav\xEDa"),t(),n(3,"p",19),i(4,"Los clics en productos aparecer\xE1n aqu\xED"),t()())}var z=(()=>{class r{constructor(e){this.productsService=e,this.totalRevenue=0,this.totalClicks=0,this.userStats=[]}ngOnInit(){this.updateStats(),this.clicksSubscription=this.productsService.clicks$.subscribe(()=>{this.updateStats()})}ngOnDestroy(){this.clicksSubscription?.unsubscribe()}updateStats(){this.totalRevenue=this.productsService.getTotalRevenue(),this.totalClicks=this.productsService.getTotalClicks(),this.userStats=this.productsService.getUserStats()}static{this.\u0275fac=function(o){return new(o||r)(g(P))}}static{this.\u0275cmp=u({type:r,selectors:[["app-sales-stats"]],standalone:!0,features:[b],decls:22,vars:4,consts:[[1,"sales-stats-container"],[1,"metrics-grid"],[1,"metric-card","revenue"],[1,"metric-icon"],[1,"metric-info"],[1,"metric-label"],[1,"metric-value"],[1,"metric-card","clicks"],["class","users-table",4,"ngIf"],["class","no-data",4,"ngIf"],[1,"users-table"],[1,"table-header"],[1,"col-email"],[1,"col-clicks"],[1,"col-spent"],[1,"table-body"],["class","table-row",4,"ngFor","ngForOf"],[1,"table-row"],[1,"no-data"],[1,"hint"]],template:function(o,s){o&1&&(n(0,"div",0)(1,"h3"),i(2,"\u{1F4B0} Estad\xEDsticas de Ventas"),t(),n(3,"div",1)(4,"div",2)(5,"div",3),i(6,"\u{1F4B5}"),t(),n(7,"div",4)(8,"span",5),i(9,"Total Recaudado"),t(),n(10,"span",6),i(11),t()()(),n(12,"div",7)(13,"div",3),i(14,"\u{1F6D2}"),t(),n(15,"div",4)(16,"span",5),i(17,"Total de Compras"),t(),n(18,"span",6),i(19),t()()()(),m(20,R,12,1,"div",8)(21,V,5,0,"div",9),t()),o&2&&(a(11),v("$",s.totalRevenue.toFixed(2),""),a(8),c(s.totalClicks),a(),l("ngIf",s.userStats.length>0),a(),l("ngIf",s.userStats.length===0))},dependencies:[_,h,C],styles:[".sales-stats-container[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid rgba(255,255,255,.15);border-radius:12px;padding:1.5rem;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}.sales-stats-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.25rem;font-weight:600}.metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:2rem}.metric-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1.25rem;border-radius:10px;background:#ffffff14;border:1px solid rgba(255,255,255,.1);transition:all .3s ease}.metric-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0003}.metric-card.revenue[_ngcontent-%COMP%]{border-left:4px solid #22c55e}.metric-card.clicks[_ngcontent-%COMP%]{border-left:4px solid #3b82f6}.metric-icon[_ngcontent-%COMP%]{font-size:2.5rem}.metric-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.metric-label[_ngcontent-%COMP%]{font-size:.85rem;opacity:.8}.metric-value[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:#000000f2}.users-table[_ngcontent-%COMP%]{margin-top:1.5rem}.users-table[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.1rem;font-weight:600}.table-header[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr 1fr;gap:1rem;padding:.75rem 1rem;align-items:center}.table-header[_ngcontent-%COMP%]{background:#ffffff1a;border-radius:8px 8px 0 0;font-weight:600;font-size:.9rem;text-transform:uppercase;letter-spacing:.5px}.table-body[_ngcontent-%COMP%]{background:#ffffff08;border-radius:0 0 8px 8px;border:1px solid rgba(255,255,255,.1)}.table-row[_ngcontent-%COMP%]{border-bottom:1px solid rgba(255,255,255,.05);transition:background .2s ease}.table-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.table-row[_ngcontent-%COMP%]:hover{background:#ffffff14}.col-email[_ngcontent-%COMP%]{font-weight:500}.col-clicks[_ngcontent-%COMP%]{text-align:center;font-weight:600;color:#3b82f6}.col-spent[_ngcontent-%COMP%]{text-align:right;font-weight:700;color:#22c55e;font-size:1.1rem}.no-data[_ngcontent-%COMP%]{text-align:center;padding:3rem 1rem;color:#0009}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-child{font-size:2rem;margin:0 0 .5rem}.no-data[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:.9rem;margin:0}@media (max-width: 768px){.metrics-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.table-header[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]{grid-template-columns:1.5fr .75fr .75fr;gap:.5rem;padding:.5rem;font-size:.85rem}.col-email[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}}"]})}}return r})();function q(r,d){if(r&1){let e=k();n(0,"button",25),x("click",function(){M(e);let s=p().$implicit,O=p(3);return S(O.deleteUser(s.email))}),i(1," Eliminar "),t()}}function B(r,d){if(r&1&&(n(0,"div",21)(1,"div",22)(2,"strong"),i(3),t(),n(4,"span"),i(5),t(),n(6,"span",23),i(7),t()(),m(8,q,2,0,"button",24),t()),r&2){let e=d.$implicit,o=p(3);a(3),c(e.name),a(2),c(e.email),a(2),c(e.role),a(),l("ngIf",!(e.email===o.getCurrentEmail()&&o.isAdmin()))}}function G(r,d){if(r&1&&(n(0,"section",18)(1,"h3"),i(2,"Gesti\xF3n de Usuarios"),t(),n(3,"div",19),m(4,B,9,4,"div",20),t()()),r&2){let e=p(2);a(4),l("ngForOf",e.getAllowedUsers())}}function L(r,d){if(r&1){let e=k();n(0,"div",2)(1,"header",3)(2,"h1"),i(3,"Bienvenido al Dashboard"),t(),n(4,"div",4)(5,"div",5)(6,"h2"),i(7),t(),n(8,"p"),i(9),t(),n(10,"span",6),i(11),t()(),n(12,"div",7)(13,"button",8),x("click",function(){M(e);let s=p();return S(s.logout())}),i(14,"Cerrar Sesi\xF3n"),t()()()(),n(15,"main",9)(16,"section",10)(17,"div",11)(18,"h3"),i(19,"Usuarios"),t(),n(20,"p",12),i(21),t(),n(22,"span",13),i(23,"Total de usuarios permitidos"),t()(),n(24,"div",11)(25,"h3"),i(26,"Gmail"),t(),n(27,"p",12),i(28),t(),n(29,"span",13),i(30,"Correo de la sesi\xF3n actual"),t()(),n(31,"div",14)(32,"h3"),i(33,"Contrase\xF1a"),t(),n(34,"p",12),i(35),t(),n(36,"span",13),i(37,"Correo de la sesi\xF3n actual"),t()()(),f(38,"hr"),n(39,"section",15),f(40,"app-sales-stats"),t(),f(41,"hr"),n(42,"section",16),f(43,"app-product-chart"),t()(),f(44,"hr"),m(45,G,5,1,"section",17),t()}if(r&2){let e=p();a(7),c(e.getUserName()),a(2),c(e.getCurrentEmail()),a(2),c(e.getUserRole()),a(10),c(e.getUsersCount()),a(7),c(e.getCurrentEmail()),a(7),c(e.getCurrentPassword()),a(10),l("ngIf",e.isAdmin())}}function Y(r,d){r&1&&(n(0,"div",26)(1,"p"),i(2,"Cargando..."),t()())}var ne=(()=>{class r{constructor(e,o){this.authService=e,this.router=o,this.currentUser=null}ngOnInit(){this.currentUser=this.authService.getCurrentUser(),this.authService.isAuthenticated()||this.router.navigate(["/login"])}logout(){this.authService.logout(),this.router.navigate(["/login"])}deleteMyAccount(){let e=this.getCurrentEmail();if(!e||this.isAdmin()||!confirm(`\xBFSeguro que deseas eliminar tu cuenta (${e})? Esta acci\xF3n no se puede deshacer.`))return;this.authService.deleteCurrentUser()&&this.router.navigate(["/login"])}getUsersCount(){return this.authService.getAllowedUsersCount()}getAllowedUsers(){return this.authService.getAllowedUsers()}getCurrentEmail(){return this.currentUser?.email||""}getCurrentPassword(){let e=this.getCurrentEmail();return e&&this.authService.getPasswordForEmail(e)||"N/D"}getUserName(){return this.currentUser?.name||"Usuario"}getUserRole(){return this.currentUser?.roles[0]||"user"}isAdmin(){return this.authService.hasRole("admin")}deleteUser(e){let o=this.getCurrentEmail();if(e===o&&this.isAdmin()||!confirm(`\xBFEliminar la cuenta ${e}?`))return;this.authService.deleteUserByEmail(e)&&(this.currentUser=this.authService.getCurrentUser())}static{this.\u0275fac=function(o){return new(o||r)(g(D),g(y))}}static{this.\u0275cmp=u({type:r,selectors:[["app-dashboard"]],standalone:!0,features:[b],decls:2,vars:2,consts:[["class","dashboard-container",4,"ngIf"],["class","loading",4,"ngIf"],[1,"dashboard-container"],[1,"dashboard-header"],[1,"user-info"],[1,"user-details"],[1,"user-role"],[1,"actions"],[1,"logout-btn",3,"click"],[1,"dashboard-content"],[1,"metrics"],[1,"card"],[1,"value"],[1,"hint"],[1,"card","warning"],[1,"sales-section"],[1,"product-stats"],["class","admin-users",4,"ngIf"],[1,"admin-users"],[1,"users-list"],["class","user-row",4,"ngFor","ngForOf"],[1,"user-row"],[1,"info"],[1,"role"],["class","delete-btn",3,"click",4,"ngIf"],[1,"delete-btn",3,"click"],[1,"loading"]],template:function(o,s){o&1&&m(0,L,46,7,"div",0)(1,Y,3,0,"div",1),o&2&&(l("ngIf",s.currentUser),a(),l("ngIf",!s.currentUser))},dependencies:[_,h,C,F,z],styles:[".dashboard-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:120px 2rem 2rem}.dashboard-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem}.user-info[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.user-details[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.user-role[_ngcontent-%COMP%]{font-size:.85rem;opacity:.8}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.logout-btn[_ngcontent-%COMP%]{background:#e74c3c;color:#fff;border:none;padding:.6rem 1rem;border-radius:8px;cursor:pointer}.logout-btn[_ngcontent-%COMP%]:hover{background:#c0392b}.delete-btn[_ngcontent-%COMP%]{background:#ff6b6b;color:#fff;border:none;padding:.6rem 1rem;border-radius:8px;cursor:pointer;font-size:.9rem}.delete-btn[_ngcontent-%COMP%]:hover{background:#ff5252}.metrics[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-bottom:2rem}.card[_ngcontent-%COMP%]{background:#ffffff10;border:1px solid rgba(255,255,255,.15);border-radius:12px;padding:1rem;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0}.card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin:.25rem 0 .5rem}.card.warning[_ngcontent-%COMP%]{border-color:#e74c3c80}.card.warning[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#e74c3c}.sales-section[_ngcontent-%COMP%], .product-stats[_ngcontent-%COMP%]{margin-top:2rem}.loading[_ngcontent-%COMP%]{padding:140px 2rem;text-align:center}.admin-users[_ngcontent-%COMP%]{margin-top:2rem;padding:1.5rem;background:#ffffff10;border:1px solid rgba(255,255,255,.15);border-radius:12px;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}.admin-users[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:1rem;font-size:1.25rem}.users-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.user-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:8px;transition:all .3s ease}.user-row[_ngcontent-%COMP%]:hover{background:#ffffff14;border-color:#fff3}.user-row[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.user-row[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1rem}.user-row[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.85rem;opacity:.8}.user-row[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .role[_ngcontent-%COMP%]{display:inline-block;padding:.2rem .5rem;background:#ffffff26;border-radius:4px;font-size:.75rem;font-weight:600;text-transform:uppercase;margin-top:.25rem}"]})}}return r})();export{ne as DashboardComponent};
