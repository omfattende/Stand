import{C as c,P as d,i as n,l as o,p as u}from"./chunk-6VMPXGO3.js";var g=(()=>{class a{constructor(){this.isAuthenticatedSubject=new n(!1),this.currentUserSubject=new n(null),this.isAuthenticated$=this.isAuthenticatedSubject.asObservable(),this.currentUser$=this.currentUserSubject.asObservable(),this.allowedUsers=[{email:"admin@stand.com",password:"123456",role:"admin",name:"Administrador"}],this.defaultClient={email:"cliente@stand.com",password:"123456",role:"client",name:"Cliente Demo"},this.registeredUsers=[],this.loadRegisteredUsers(),this.checkStoredAuth()}loadRegisteredUsers(){let e=localStorage.getItem("registeredUsers");if(e)try{this.registeredUsers=JSON.parse(e)}catch{this.registeredUsers=[]}}saveRegisteredUsers(){localStorage.setItem("registeredUsers",JSON.stringify(this.registeredUsers))}checkStoredAuth(){let e=localStorage.getItem("isAuthenticated"),t=localStorage.getItem("currentUser");if(e==="true"&&t)try{let s=JSON.parse(t);this.isAuthenticatedSubject.next(!0),this.currentUserSubject.next(s)}catch{this.clearAuthData()}}register(e,t,s){return o(null).pipe(c(500),u(()=>{let r=this.allowedUsers.find(i=>i.email===e),l=this.registeredUsers.find(i=>i.email===e);return r||l?{success:!1,message:"Este email ya est\xE1 registrado"}:(this.registeredUsers.push({email:e,password:t,role:"client",name:s}),this.saveRegisteredUsers(),{success:!0,message:"Registro exitoso"})}))}login(e,t){return o(null).pipe(c(500),u(()=>{let s=this.allowedUsers.find(r=>r.email===e&&r.password===t);if(!s&&this.defaultClient.email===e&&this.defaultClient.password===t&&(s=this.defaultClient),s||(s=this.registeredUsers.find(r=>r.email===e&&r.password===t)),s){let r={id:Date.now(),email:s.email,name:s.name,roles:[s.role],avatar:s.role==="admin"?"\u{1F468}\u200D\u{1F4BC}":"\u{1F464}",department:s.role==="admin"?"Administraci\xF3n":"Cliente"};return this.setAuthData(r),!0}return!1}))}setAuthData(e){this.isAuthenticatedSubject.next(!0),this.currentUserSubject.next(e),localStorage.setItem("isAuthenticated","true"),localStorage.setItem("currentUser",JSON.stringify(e))}logout(){this.clearAuthData(),this.isAuthenticatedSubject.next(!1),this.currentUserSubject.next(null)}deleteCurrentUser(){let e=this.currentUserSubject.value;return e?this.deleteUserByEmail(e.email):!1}deleteUserByEmail(e){let s=this.currentUserSubject.value?.email===e,r=this.allowedUsers.findIndex(i=>i.email===e);if(r!==-1)return this.allowedUsers.splice(r,1),s&&this.logout(),!0;let l=this.registeredUsers.findIndex(i=>i.email===e);return l!==-1?(this.registeredUsers.splice(l,1),this.saveRegisteredUsers(),s&&this.logout(),!0):!1}clearAuthData(){localStorage.removeItem("isAuthenticated"),localStorage.removeItem("currentUser")}isAuthenticated(){return this.isAuthenticatedSubject.value}getCurrentUser(){return this.currentUserSubject.value}hasRole(e){let t=this.currentUserSubject.value;return t?t.roles.includes(e):!1}isAdmin(){return this.hasRole("admin")}isSales(){return this.hasRole("sales")}addUser(e,t,s,r){this.allowedUsers.push({email:e,password:t,role:s,name:r})}getAllowedUsers(){return[...this.allowedUsers.map(t=>({email:t.email,role:t.role,name:t.name})),...this.registeredUsers.map(t=>({email:t.email,role:t.role,name:t.name}))]}getAllowedUsersCount(){return this.allowedUsers.length+this.registeredUsers.length}getPasswordForEmail(e){let t=this.allowedUsers.find(s=>s.email===e);return t?t.password:null}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275prov=d({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{g as a};
